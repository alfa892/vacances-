<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sri Lanka Express â€” Plan de voyage (9 jours)</title>
  <meta name="description" content="Plan de voyage pragmatique et complet â€” ItinÃ©raire jour par jour, budget, transports, checklists. Partage gratuit.">
  <style>
    /* ====== Design systÃ¨me, sans dÃ©pendances ====== */
    :root{
      --bg: #0b0c10;
      --card:#111218;
      --muted:#8992a1;
      --text:#e6e8ec;
      --brand:#4f46e5;
      --brand-2:#22c55e;
      --accent:#0ea5e9;
      --warning:#f59e0b;
      --danger:#ef4444;
      --ring: 0 0 0 3px rgba(79,70,229,.35);
      --radius: 16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font: 16px/1.45 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text); background: radial-gradient(1200px 800px at 20% -10%, rgba(34,197,94,.15), transparent 40%), radial-gradient(1000px 700px at 120% 0%, rgba(14,165,233,.18), transparent 50%), var(--bg);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}
    .container{width:min(1150px, 100% - 2rem); margin-inline:auto}
    .grid{display:grid; gap:1rem}
    .grid-2{grid-template-columns:repeat(2, minmax(0,1fr))}
    .grid-3{grid-template-columns:repeat(3, minmax(0,1fr))}
    @media (max-width: 960px){.grid-2,.grid-3{grid-template-columns:1fr}}

    /* Header */
    header.hero{position:relative; padding: 2.5rem 0 1.25rem}
    .badge{display:inline-flex; align-items:center; gap:.4rem; border:1px solid rgba(255,255,255,.12); padding:.25rem .6rem; border-radius:999px; color:#cbd5e1; background:rgba(17,18,24,.6); backdrop-filter: blur(6px)}
    .title{font-weight:800; letter-spacing:.2px; font-size: clamp(2rem, 3.2vw, 3rem); margin:.6rem 0}
    .subtitle{color:var(--muted); max-width:65ch}
    .hero-actions{display:flex; gap:.5rem; flex-wrap:wrap; margin-top:1rem}
    button, .btn{appearance:none; border:0; background:var(--brand); color:white; border-radius:12px; padding:.7rem 1rem; font-weight:600; cursor:pointer}
    button:hover, .btn:hover{filter:brightness(1.05)}
    .btn.secondary{background:#1f2937; color:#e5e7eb}
    .btn.ghost{background:transparent; border:1px solid rgba(255,255,255,.16)}

    nav.sticky{
      position: sticky; top:0; z-index:25; background:rgba(11,12,16,.7); backdrop-filter: blur(8px);
      border-bottom:1px solid rgba(255,255,255,.08)
    }
    .nav-inner{display:flex; gap:.5rem; overflow:auto; padding:.5rem 0}
    .chip{white-space:nowrap; border:1px solid rgba(255,255,255,.15); padding:.45rem .75rem; border-radius:999px; color:#d1d5db; background:rgba(17,18,24,.5)}
    .chip.active{background:linear-gradient(90deg, rgba(79,70,229,.25), rgba(34,197,94,.25)); color:white; border-color:transparent}

    /* Cards */
    .card{background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.09); border-radius: var(--radius); padding:1rem}
    .card h3{margin:.25rem 0 .5rem; font-size:1.05rem}
    .muted{color:var(--muted)}
    .kpi{font-weight:800; font-size:1.45rem}

    /* Sections */
    section{scroll-margin-top:80px; padding:1.25rem 0}
    .section-title{display:flex; align-items:center; gap:.6rem; font-size:1.2rem; margin: .5rem 0 .75rem}

    /* Day accordion */
    details.day{border:1px solid rgba(255,255,255,.1); border-radius: var(--radius); padding:.8rem 1rem; background:rgba(17,18,24,.5)}
    summary{list-style:none; cursor:pointer}
    summary::-webkit-details-marker{display:none}
    .day-head{display:flex; align-items:center; justify-content:space-between; gap:.75rem}
    .day-head b{font-size:1.05rem}
    .pill{display:inline-flex; align-items:center; gap:.4rem; background:rgba(34,197,94,.12); color:#86efac; border:1px solid rgba(34,197,94,.22); padding:.15rem .5rem; border-radius:999px; font-size:.85rem}
    .list{margin:.4rem 0 0; padding-left:1rem}
    .list li{margin:.25rem 0}
    .alt{border-left:3px solid rgba(14,165,233,.55); padding-left:.65rem; margin-top:.35rem}

    /* Tables */
    table{width:100%; border-collapse:collapse; margin:.25rem 0}
    th,td{padding:.5rem .6rem; border-bottom:1px dashed rgba(255,255,255,.08); text-align:left}
    th{color:#cbd5e1; font-weight:600}
    td.k{color:#cbd5e1}
    td.v{text-align:right}

    /* Utilities */
    .row{display:flex; gap:1rem; align-items:center}
    .right{margin-left:auto}
    .spacer{height:1rem}
    .tiny{font-size:.85rem}
    .code{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size:.9em}

    /* Footer */
    footer{border-top:1px solid rgba(255,255,255,.08); color:#a1a1aa; padding:1.25rem 0 3rem}

    /* Print */
    @media print{
      nav.sticky, .hero-actions, .date-picker{display:none}
      body{background:white; color:black}
      .card, details.day{background:white; border-color:#e5e7eb}
      a{color:black}
    }
  </style>
</head>
<body>
  <header class="hero container">
    <div class="badge">Sri Lanka Â· 9 jours Â· entre amis</div>
    <h1 class="title">Sri Lanka Express â€” plan de voyage <span class="muted">(pragmatique)</span></h1>
    <p class="subtitle">ItinÃ©raire jour par jour, temps de trajets, budget, mÃ©tÃ©o attendue, checklists et exports. AdaptÃ© Ã  un groupe. ZÃ©ro blabla inutile.</p>
    <div class="hero-actions">
      <button id="btnPrint" title="Imprimer / PDF">ğŸ–¨ï¸ Imprimer / PDF</button>
      <button id="btnIcs" class="btn secondary" title="Exporter le calendrier (.ics)">ğŸ“† Export .ics</button>
      <button id="btnExpand" class="btn ghost" title="Tout dÃ©rouler">â• Tout dÃ©rouler</button>
      <button id="btnCollapse" class="btn ghost" title="Tout replier">â– Tout replier</button>
    </div>
  </header>

  <nav class="sticky">
    <div class="container nav-inner" id="nav">
      <a class="chip active" href="#recap">RÃ©cap</a>
      <a class="chip" href="#dates">Dates</a>
      <a class="chip" href="#itinerary">ItinÃ©raire</a>
      <a class="chip" href="#meteo">MÃ©tÃ©o</a>
      <a class="chip" href="#logements">Logements</a>
      <a class="chip" href="#transports">Transports</a>
      <a class="chip" href="#activites">ActivitÃ©s</a>
      <a class="chip" href="#budget">Budget</a>
      <a class="chip" href="#checklist">Checklists</a>
      <a class="chip" href="#roles">RÃ´les</a>
      <a class="chip" href="#plansB">Plans B</a>
    </div>
  </nav>

  <main class="container">
    <!-- RÃ©cap -->
    <section id="recap">
      <div class="section-title">ğŸ§­ RÃ©cap express</div>
      <div class="grid grid-3">
        <div class="card">
          <h3>Format</h3>
          <div class="kpi">9 jours</div>
          <div class="muted tiny">Jeudi â†’ dimanche suivant Â· 7 jours de congÃ©s max</div>
        </div>
        <div class="card">
          <h3>Parcours</h3>
          <div class="kpi">Colombo â†’ CÃ´te Sud â†’ Udawalawe â†’ Ella â†’ Kandy â†’ Dambulla/Sigiriya â†’ Trincomalee</div>
        </div>
        <div class="card">
          <h3>Budget cible / pers.</h3>
          <div class="kpi">1â€¯667,26Â â‚¬</div>
          <div class="muted tiny">Vols inclus</div>
        </div>
      </div>
    </section>

    <!-- Dates -->
    <section id="dates">
      <div class="section-title">ğŸ“… Dates & calendrier</div>
      <div class="card">
        <div class="row date-picker">
          <label for="startDate"><b>Date de <u>dÃ©part (jeudi)</u> :</b></label>
          <input id="startDate" type="date" />
          <span class="muted tiny">AstuceÂ : choisissez un des jeudis proposÃ©s ciâ€‘dessous pour caler les jours J1â†’J9 automatiquement.</span>
        </div>
        <div class="spacer"></div>
        <div class="grid grid-3">
          <div class="card">
            <h3>FenÃªtre 1</h3>
            <p class="muted">Jeu 4 â†’ Dim 14 juin</p>
            <button class="btn" data-quick-date="2025-06-04">Choisir ce jeudi</button>
          </div>
          <div class="card">
            <h3>FenÃªtre 2</h3>
            <p class="muted">Jeu 11 â†’ Dim 21 juin</p>
            <button class="btn" data-quick-date="2025-06-11">Choisir ce jeudi</button>
          </div>
          <div class="card">
            <h3>FenÃªtre 3</h3>
            <p class="muted">Jeu 18 â†’ Dim 28 juin</p>
            <button class="btn" data-quick-date="2025-06-18">Choisir ce jeudi</button>
          </div>
        </div>
      </div>
    </section>

    <!-- ItinÃ©raire -->
    <section id="itinerary">
      <div class="section-title">ğŸ—ºï¸ ItinÃ©raire jour par jour</div>
      <div id="days" class="grid"></div>
    </section>

    <!-- MÃ©tÃ©o -->
    <section id="meteo">
      <div class="section-title">ğŸŒ¦ï¸ MÃ©tÃ©o attendue (juin)</div>
      <div class="grid grid-2">
        <div class="card">
          <h3>AperÃ§u</h3>
          <ul class="list">
            <li>Sud/Ouest (Colombo, CÃ´te Sud, Kandy, Ella)Â : averses courtes, Ã©claircies ensuite.</li>
            <li>Est (Trincomalee)Â : plus sec, mer plus calme.</li>
          </ul>
        </div>
        <div class="card">
          <h3>Par Ã©tape</h3>
          <ul class="list">
            <li><b>Colombo</b>Â : chaleur humide, pluies fin de journÃ©e possibles.</li>
            <li><b>CÃ´te Sud</b>Â : mer formÃ©e par moments, surf dÃ©butant OK (Weligama).</li>
            <li><b>Udawalawe</b>Â : chaud, faune active tÃ´t.</li>
            <li><b>Ella</b>Â : plus frais, brumes/grains lâ€™aprÃ¨sâ€‘midi.</li>
            <li><b>Kandy</b>Â : averses intermittentes.</li>
            <li><b>Dambulla/Sigiriya</b>Â : plutÃ´t sec & chaud.</li>
            <li><b>Trincomalee</b>Â : ensoleillÃ©, snorkelling/bateau favorables.</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Logements -->
    <section id="logements">
      <div class="section-title">ğŸ¨ Logements â€” critÃ¨res</div>
      <div class="grid grid-2">
        <div class="card">
          <h3>RÃ©partition</h3>
          <ul class="list">
            <li>ColomboÂ : boutiqueâ€‘hÃ´tel central ou prÃ¨s du lac.</li>
            <li>Unawatuna/MirissaÂ : hÃ´tel/Airbnb proche plage.</li>
            <li>EllaÂ : guesthouse vue collines.</li>
            <li>KandyÂ : hÃ´tel calme, accÃ¨s temples.</li>
            <li>TrincomaleeÂ : villa/hÃ´tel bord de mer (Uppuveli/Dutch Bay).</li>
          </ul>
        </div>
        <div class="card">
          <h3>Ã€ vÃ©rifier</h3>
          <ul class="list">
            <li>Petitâ€‘dÃ©j inclusÂ ? RÃ©ception 24/7Â ? Checkâ€‘in tardifÂ ?</li>
            <li>Bagagerie le jour dâ€™arrivÃ©e/dÃ©partÂ ?</li>
            <li>Chambres doubles, lits sÃ©parÃ©s si besoin.</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Transports -->
    <section id="transports">
      <div class="section-title">ğŸš Transports â€” temps & modes</div>
      <div class="grid grid-2">
        <div class="card">
          <h3>Temps de route rÃ©alistes</h3>
          <table>
            <tr><td class="k">Colombo â†’ Unawatuna</td><td class="v">2â€“2h30</td></tr>
            <tr><td class="k">Unawatuna â†’ Udawalawe</td><td class="v">3â€“3h30</td></tr>
            <tr><td class="k">Udawalawe â†’ Ella</td><td class="v">3â€“3h30</td></tr>
            <tr><td class="k">Ella â†’ Kandy (train)</td><td class="v">5â€“7h</td></tr>
            <tr><td class="k">Kandy â†’ Dambulla</td><td class="v">2â€“2h30</td></tr>
            <tr><td class="k">Sigiriya â†’ Trincomalee</td><td class="v">3,5â€“4,5h</td></tr>
            <tr><td class="k">Trincomalee â†’ Colombo</td><td class="v">5,5â€“7h</td></tr>
          </table>
        </div>
        <div class="card">
          <h3>Conseils groupe</h3>
          <ul class="list">
            <li>Van privÃ© pour les liaisons longues (coÃ»t partagÃ©).</li>
            <li>Train Ellaâ†’KandyÂ : tenter places rÃ©servÃ©es, sinon 2e/3e classe.</li>
            <li>Tukâ€‘tuks pour courts trajets (1â€“4Â km).</li>
            <li>Conduite Ã  gaucheÂ ; on Ã©vite la location de voiture.</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- ActivitÃ©s -->
    <section id="activites">
      <div class="section-title">ğŸ¯ ActivitÃ©s & rÃ©servations</div>
      <div class="grid grid-2">
        <div class="card">
          <h3>Immanquables</h3>
          <ul class="list">
            <li>Safari Udawalawe (3h, dÃ©part tÃ´t).</li>
            <li>Snorkelling tortues (Mirissa), respect distance.</li>
            <li>Surf dÃ©butant (Weligama, 1â€“1h30).</li>
            <li>Tea factory Uva Halpewatte.</li>
            <li>Flying Ravana (mÃ©ga zipline).</li>
            <li>Temple de la Dent, Jardins botaniques.</li>
            <li>Grottes de Dambulla, rocher de Sigiriya.</li>
            <li>TrincomaleeÂ : baleines (selon mer), Pigeon Island.</li>
          </ul>
        </div>
        <div class="card">
          <h3>RÃ¨gles simples</h3>
          <ul class="list">
            <li>Tenue templesÂ : Ã©paules/genoux couverts, chaussures retirÃ©es.</li>
            <li>AmbuluwawaÂ : escalier Ã©troit, Ã©viter par grand vent.</li>
            <li>FauneÂ : ne pas toucher/nourrir (tortues/singes).</li>
            <li>Pigeon IslandÂ : ne pas piÃ©tiner les coraux.</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Budget -->
    <section id="budget">
      <div class="section-title">ğŸ’¶ Budget / personne (estimation)</div>
      <div class="grid grid-2">
        <div class="card">
          <table>
            <tr><td class="k">Avion A/R</td><td class="v" data-money="650">650,00 â‚¬</td></tr>
            <tr><td class="k">Logement</td><td class="v" data-money="470.62">470,62 â‚¬</td></tr>
            <tr><td class="k">ActivitÃ©s</td><td class="v" data-money="255">255,00 â‚¬</td></tr>
            <tr><td class="k">Transports terrestres & train</td><td class="v" data-money="41.64">41,64 â‚¬</td></tr>
            <tr><td class="k">Repas & boissons</td><td class="v" data-money="250">250,00 â‚¬</td></tr>
            <tr><th>Total</th><th class="v" id="budgetTotal">â€”</th></tr>
          </table>
          <p class="muted tiny">RepÃ¨res prixÂ : snack 1â€“3Â â‚¬ Â· repas 2â€“6Â â‚¬ Â· restau 6â€“12Â â‚¬ Â· poisson 8â€“15Â â‚¬ Â· jus/cafÃ© 1â€“3Â â‚¬ Â· biÃ¨re 2â€“3,5Â â‚¬ Â· cocktail 5â€“9Â â‚¬.</p>
        </div>
        <div class="card">
          <h3>Paiements</h3>
          <ul class="list">
            <li>CB en ville/hÃ´tels ; cash pour tukâ€‘tuks, petits achats, tips.</li>
            <li>RetraitsÂ : privilÃ©gier 1â€“2 gros retraits (moins de frais).</li>
            <li>Deux cartes par binÃ´me, sÃ©parÃ©es.</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Checklists -->
    <section id="checklist">
      <div class="section-title">ğŸ§³ Checklists</div>
      <div class="grid grid-2">
        <div class="card">
          <h3>Ã€ emporter</h3>
          <ul class="list">
            <li>VÃªtementsÂ : maillot, 3â€“4 tâ€‘shirts, short, pantalon lÃ©ger, kâ€‘way, sweat.</li>
            <li>ChaussuresÂ : baskets + sandales.</li>
            <li>TemplesÂ : parÃ©o/Ã©charpe ; short sous genou/pantalon.</li>
            <li>SoleilÂ : casquette, lunettes, crÃ¨me solaire.</li>
            <li>PharmacieÂ : pansements, antalgique, antiâ€‘mal des transports, antiâ€‘diarrhÃ©ique, rÃ©pulsif moustiques.</li>
            <li>Ã‰lectricitÃ©Â : adaptateur universel, powerbank.</li>
            <li>EauÂ : gourde rÃ©utilisable.</li>
            <li>SnorkelÂ : masque perso (optionnel).</li>
          </ul>
        </div>
        <div class="card">
          <h3>Avant dÃ©part</h3>
          <ul class="list">
            <li>ETA (visa Ã©lectronique) validÃ©, passeport &gt; 6Â mois.</li>
            <li>Assurance voyage (soins + rapatriement).</li>
            <li>Copies passeports/assurances (cloud + offline).</li>
            <li>Confirmations chauffeurs/hÃ´tels/train.</li>
            <li>Appli de dÃ©penses pour caisse commune.</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- RÃ´les -->
    <section id="roles">
      <div class="section-title">ğŸ§© RÃ´les (proposition)</div>
      <div class="card">
        <ul class="list">
          <li>Coordination vols & documents.</li>
          <li>HÃ©bergements (rÃ©servations + confirmations).</li>
          <li>Chauffeur/van & safari.</li>
          <li>Train Ellaâ†’Kandy.</li>
          <li>ActivitÃ©s mer Ã  Trincomalee.</li>
          <li>Caisse commune.</li>
          <li>Secours & santÃ© (kit + numÃ©ros utiles).</li>
        </ul>
      </div>
    </section>

    <!-- Plans B -->
    <section id="plansB">
      <div class="section-title">â›‘ï¸ Plans B mÃ©tÃ©o</div>
      <div class="grid grid-2">
        <div class="card">
          <h3>CÃ´te Sud sous pluie</h3>
          <p class="muted">Bascule Galle (musÃ©e, cafÃ©s, shopping), spa ayurvÃ©dique, cours de cuisine.</p>
        </div>
        <div class="card">
          <h3>Ella brume/pluie</h3>
          <p class="muted">Raccourcir zipline, garder tea factory, cafÃ©s couverts.</p>
        </div>
        <div class="card">
          <h3>Train complet</h3>
          <p class="muted">Van Ellaâ†’Kandy + arrÃªts panoramiques.</p>
        </div>
        <div class="card">
          <h3>Mer agitÃ©e Ã  Trinco</h3>
          <p class="muted">Plages abritÃ©es (SandyÂ Cove/DutchÂ Bay), temples, marchÃ© local.</p>
        </div>
      </div>
    </section>

    <footer class="container">
      <div class="row">
        <span>Fait pour le groupe â€” partage libre.</span>
        <span class="right tiny muted">DerniÃ¨re mise Ã  jourÂ : <span id="lastUpdated"></span></span>
      </div>
    </footer>
  </main>

  <script>
    // ====== DonnÃ©es structurÃ©es (Ã©dition simple) ======
    const plan = {
      title: "Sri Lanka Express â€” 9 jours",
      // ItinÃ©raire: chaque bloc jour a des segments avec horaires locaux indicatifs (Asia/Colombo)
      days: [
        {
          key: "J1",
          name: "Colombo â†’ Unawatuna",
          offsetFromThursday: 1, // Vendredi local
          segments: [
            { time: "02:50â€“04:30", label: "ArrivÃ©e CMB Â· SIM/ATM Â· Transfert hÃ´tel" },
            { time: "09:00â€“17:30", label: "ColomboÂ : Jami Ulâ€‘Afar Â· Pettah Â· Gangaramaya Â· Port City" },
            { time: "19:00â€“21:30", label: "Route Colombo â†’ Unawatuna (van) Â· Checkâ€‘in" },
          ],
          alt: "PluieÂ : musÃ©es/cafÃ©s Ã  Colombo, Lotus Tower si visibilitÃ©",
        },
        {
          key: "J2",
          name: "CÃ´te SudÂ : Unawatuna/Mirissa/Weligama",
          offsetFromThursday: 2, // Samedi
          segments: [
            { time: "07:15â€“08:00", label: "Coconut Tree Hill" },
            { time: "08:30â€“11:00", label: "Mirissa Â· snorkelling tortues (respect distance)" },
            { time: "11:45â€“13:15", label: "Weligama Â· cours de surf dÃ©butant" },
            { time: "14:30â€“17:30", label: "PlagesÂ : Dalawella Â· Mihiripenna Â· Ahangama" },
          ],
          alt: "PluieÂ : Fort de Galle, cafÃ©s, soins ayurvÃ©diques",
        },
        {
          key: "J3",
          name: "Udawalawe â†’ Ella",
          offsetFromThursday: 3, // Dimanche
          segments: [
            { time: "05:00â€“08:30", label: "Route Unawatuna â†’ Udawalawe" },
            { time: "08:30â€“11:30", label: "Safari Udawalawe (4Ã—4 + guide)" },
            { time: "13:00â€“16:30", label: "Route Udawalawe â†’ Ella" },
          ],
          alt: "â€”",
        },
        {
          key: "J4",
          name: "Ella â†’ Kandy (train panoramique)",
          offsetFromThursday: 4, // Lundi
          segments: [
            { time: "07:30â€“09:30", label: "Uva Halpewatte Tea Â· visite + dÃ©gustation" },
            { time: "10:30â€“11:30", label: "Flying Ravana Â· mÃ©ga zipline" },
            { time: "12:00â€“18:00", label: "Train Ella â†’ Kandy (5â€“7h selon convoi)" },
          ],
          alt: "Train completÂ : van Ella â†’ Kandy + points de vue",
        },
        {
          key: "J5",
          name: "Kandy",
          offsetFromThursday: 5, // Mardi
          segments: [
            { time: "08:00â€“10:30", label: "Temple de la Dent (tenue requise)" },
            { time: "11:00â€“13:00", label: "Ambuluwawa Tower (vue 360Â°)" },
            { time: "15:00â€“17:00", label: "Jardins botaniques (Peradeniya)" },
            { time: "19:00â€“20:00", label: "Spectacle traditionnel" },
          ],
          alt: "Cours de cuisineÂ : placer Kandy ou Galle selon mÃ©tÃ©o",
        },
        {
          key: "J6",
          name: "Dambulla â†’ Sigiriya â†’ Trincomalee",
          offsetFromThursday: 6, // Mercredi
          segments: [
            { time: "07:00â€“09:30", label: "Route Kandy â†’ Dambulla" },
            { time: "09:30â€“11:00", label: "Grottes de Dambulla" },
            { time: "12:00â€“14:00", label: "Sigiriya (montÃ©e + sommet)" },
            { time: "14:00â€“18:30", label: "Route Sigiriya â†’ Trincomalee" },
          ],
          alt: "â€”",
        },
        {
          key: "J7",
          name: "Trincomalee â€” large & rÃ©cifs",
          offsetFromThursday: 7, // Jeudi
          segments: [
            { time: "06:00â€“12:00", label: "Sortie baleines (si mer OK)" },
            { time: "14:30â€“17:30", label: "Pigeon Island Â· snorkelling" },
          ],
          alt: "Mer agitÃ©eÂ : plages abritÃ©es (SandyÂ Cove/DutchÂ Bay)",
        },
        {
          key: "J8",
          name: "Trincomalee â€” temples & plages",
          offsetFromThursday: 8, // Vendredi
          segments: [
            { time: "09:00â€“11:00", label: "Koneswaram Kovil" },
            { time: "11:30â€“12:30", label: "Sri Badrakali Amman" },
            { time: "15:30â€“18:30", label: "Uppuveli / SandyÂ Cove / DutchÂ Bay" },
          ],
          alt: "â€”",
        },
        {
          key: "J9",
          name: "Retour (Trinco â†’ Colombo â†’ Paris)",
          offsetFromThursday: 9, // Samedi
          segments: [
            { time: "08:00â€“10:30", label: "Dernier bain Â· checkâ€‘out" },
            { time: "17:00â€“23:59", label: "Route Trincomalee â†’ Colombo" },
            { time: "04:05 (+1)", label: "Vol retour (nuit samâ†’dim)" },
          ],
          alt: "â€”",
        },
      ],
    };

    // ====== Rendu dynamique de l'itinÃ©raire ======
    const daysEl = document.getElementById('days');
    const startDateInput = document.getElementById('startDate');
    const moneyNodes = [...document.querySelectorAll('[data-money]')];

    function euro(n){ return new Intl.NumberFormat('fr-FR', {style:'currency', currency:'EUR'}).format(n); }

    function parseTimeRangeToISO(dateObj, timeStr){
      // timeStr formats: "HH:MMâ€“HH:MM" or "HH:MM (single)" or "HH:MM (+1)"
      // Returns {start: Date, end: Date|null}
      const plusOne = timeStr.includes('(+1)');
      const m = timeStr.match(/(\d{2}:\d{2})(?:[\u2013\-](\d{2}:\d{2}))?/);
      if(!m) return {start:null, end:null};
      const [_, t1, t2] = m;
      const [h1, min1] = t1.split(':').map(Number);
      const d1 = new Date(dateObj);
      d1.setHours(h1, min1, 0, 0);
      let d2 = null;
      if(t2){
        const [h2, min2] = t2.split(':').map(Number);
        d2 = new Date(dateObj);
        d2.setHours(h2, min2, 0, 0);
        if(plusOne || d2 < d1){ d2 = new Date(d2.getTime() + 24*3600*1000); }
      }
      return {start:d1, end:d2};
    }

    function formatDateLabel(baseThursday, offsetDays){
      if(!baseThursday) return '';
      const d = new Date(baseThursday.getTime() + offsetDays*86400000);
      return d.toLocaleDateString('fr-FR', {weekday:'long', day:'2-digit', month:'short'});
    }

    function renderDays(){
      const base = startDateInput.value ? new Date(startDateInput.value + 'T00:00:00') : null; // Thursday
      daysEl.innerHTML = '';
      plan.days.forEach((day, idx) =>{
        const label = base ? `${day.key} Â· ${formatDateLabel(base, day.offsetFromThursday)}` : day.key;
        const details = document.createElement('details');
        details.className = 'day';
        if(idx < 3) details.open = true; // ouvrir les 3 premiers par dÃ©faut
        const summary = document.createElement('summary');
        summary.innerHTML = `<div class="day-head"><div><b>${label}</b><div class="muted tiny">${day.name}</div></div><span class="pill">${day.segments.length} blocs</span></div>`;
        details.appendChild(summary);
        const ul = document.createElement('ul');
        ul.className = 'list';
        day.segments.forEach(seg =>{
          const li = document.createElement('li');
          li.innerHTML = `<span class="code">${seg.time}</span> â€” ${seg.label}`;
          ul.appendChild(li);
        });
        details.appendChild(ul);
        if(day.alt && day.alt !== 'â€”'){
          const alt = document.createElement('div');
          alt.className = 'alt tiny muted';
          alt.textContent = `Plan BÂ : ${day.alt}`;
          details.appendChild(alt);
        }
        daysEl.appendChild(details);
      });
    }

    // ====== Budget total ======
    function renderBudget(){
      const total = moneyNodes.reduce((s, n)=> s + Number(n.dataset.money||0), 0);
      document.getElementById('budgetTotal').textContent = euro(total);
    }

    // ====== Export ICS ======
    function pad(n){return String(n).padStart(2,'0')}
    function toICSDate(d){
      return d.getUTCFullYear()+pad(d.getUTCMonth()+1)+pad(d.getUTCDate())+'T'+pad(d.getUTCHours())+pad(d.getUTCMinutes())+'00Z';
    }
    function download(filename, text){
      const a = document.createElement('a');
      a.href = URL.createObjectURL(new Blob([text], {type:'text/calendar;charset=utf-8'}));
      a.download = filename; a.click(); URL.revokeObjectURL(a.href);
    }
    function exportICS(){
      if(!startDateInput.value){
        alert('Choisissez dâ€™abord la date de dÃ©part (jeudi).');
        return;
      }
      const tz = 'Asia/Colombo';
      const baseThu = new Date(startDateInput.value + 'T00:00:00');
      let ics = 'BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Sri Lanka Express//FR\nCALSCALE:GREGORIAN\nMETHOD:PUBLISH\n';
      plan.days.forEach(day=>{
        // Utiliser le premier segment pour dater le bloc jour
        const localDate = new Date(baseThu.getTime() + day.offsetFromThursday*86400000);
        // CrÃ©er un Ã©vÃ©nement par segment avec des heures si disponibles
        day.segments.forEach(seg=>{
          const tr = parseTimeRangeToISO(localDate, seg.time);
          const start = tr.start ? toICSDate(tr.start) : toICSDate(localDate);
          const end = tr.end ? toICSDate(tr.end) : toICSDate(new Date(localDate.getTime()+2*3600*1000));
          const uid = Math.random().toString(36).slice(2) + '@slexpress';
          const summary = `${day.key} â€” ${seg.label}`.slice(0,130);
          const desc = `${day.name}`;
          ics += 'BEGIN:VEVENT\n';
          ics += `UID:${uid}\n`;
          ics += `DTSTAMP:${toICSDate(new Date())}\n`;
          ics += `DTSTART:${start}\n`;
          ics += `DTEND:${end}\n`;
          ics += `SUMMARY:${summary.replace(/\n/g,' ')}\n`;
          ics += `DESCRIPTION:${desc.replace(/\n/g,' ')}\n`;
          ics += `LOCATION:Sri Lanka\n`;
          ics += 'END:VEVENT\n';
        });
      });
      ics += 'END:VCALENDAR\n';
      download('sri-lanka-express.ics', ics);
    }

    // ====== UI bindings ======
    document.getElementById('btnPrint').addEventListener('click', ()=> window.print());
    document.getElementById('btnIcs').addEventListener('click', exportICS);
    document.getElementById('btnExpand').addEventListener('click', ()=> document.querySelectorAll('details.day').forEach(d=> d.open = true));
    document.getElementById('btnCollapse').addEventListener('click', ()=> document.querySelectorAll('details.day').forEach(d=> d.open = false));
    document.querySelectorAll('[data-quick-date]').forEach(btn=> btn.addEventListener('click', (e)=>{
      startDateInput.value = e.currentTarget.getAttribute('data-quick-date');
      renderDays();
      window.scrollTo({top: document.getElementById('itinerary').offsetTop - 70, behavior:'smooth'});
    }));
    startDateInput.addEventListener('change', renderDays);

    // Active chip on scroll
    const sections = [...document.querySelectorAll('main section')];
    const nav = document.getElementById('nav');
    const chips = [...nav.querySelectorAll('.chip')];
    const observer = new IntersectionObserver(entries=>{
      entries.forEach(entry=>{
        if(entry.isIntersecting){
          chips.forEach(c=> c.classList.remove('active'));
          const id = '#' + entry.target.id;
          const link = chips.find(c=> c.getAttribute('href')===id);
          if(link) link.classList.add('active');
        }
      })
    }, {rootMargin:'-50% 0px -45% 0px', threshold: [0, 1]});
    sections.forEach(s=> observer.observe(s));

    // Init
    renderDays();
    renderBudget();
    document.getElementById('lastUpdated').textContent = new Date().toLocaleString('fr-FR', {dateStyle:'medium', timeStyle:'short'});
  </script>
</body>
</html>
